## Project Architecture

Glix is a centralized cross-payment platform built with **Next.js 15 + Payload CMS v3**, deployed on Vercel. The platform acts as an intermediary allowing users to transfer funds between different payment services (e.g., Stripe to PayPal). Users can register, link payment accounts, initiate/receive transactions, and track their payment history through a modern web interface.

### High-Level Architecture

**Unified Next.js Application:**
- **Frontend (Client-Facing)**: User registration, dashboards, transaction initiation, status tracking
- **Data Layer (Integrated)**: Payload CMS embedded within Next.js for data management and admin UI
- **API Layer**: RESTful and GraphQL APIs auto-generated by Payload + custom Next.js API routes
- **Database**: MongoDB (Payload's default), hosted on MongoDB Atlas for scalability
- **Authentication**: JWT-based, managed natively by Payload within Next.js
- **Deployment**: Single unified application on Vercel using Next.js App Router

**Key Innovation:**
Payload CMS v3 runs directly within the Next.js application using the `withPayload` plugin, eliminating the need for separate server infrastructure. This provides:
- **Single Codebase**: Shared types, utilities, and environment configuration
- **Reduced Latency**: Direct in-process data access instead of HTTP calls
- **Simplified Deployment**: One Vercel deployment for both frontend and backend
- **Better DX**: Single `npm run dev` command for local development

### Project Structure

```
/home/frost/dev/glix/glix-web/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (payload)/              # Payload CMS admin and auto-generated APIs
â”‚   â”‚   â”œâ”€â”€ admin/              # Admin panel UI
â”‚   â”‚   â”œâ”€â”€ api/                # REST (/api/*) and GraphQL (/api/graphql)
â”‚   â”‚   â””â”€â”€ layout.tsx          # Payload-specific layout
â”‚   â”œâ”€â”€ (client)/               # Client-facing application
â”‚   â”‚   â”œâ”€â”€ (shell)/            # Shared layout (Header, Footer)
â”‚   â”‚   â”œâ”€â”€ (routes)/           # Standard pages (join-waitlist, about-us)
â”‚   â”‚   â”œâ”€â”€ (home)/             # Home with parallel routes (@hero, @solutions)
â”‚   â”‚   â””â”€â”€ globals.css         # Tailwind CSS v4 styles
â”‚   â””â”€â”€ api/                    # Custom API routes (e.g., /api/waitlist)
â”œâ”€â”€ collections/                # Payload collections (Users, Accounts, Transactions)
â”‚   â”œâ”€â”€ Users/
â”‚   â”œâ”€â”€ Accounts/
â”‚   â”œâ”€â”€ Transactions/
â”‚   â”œâ”€â”€ Media/
â”‚   â””â”€â”€ common/                 # Shared helpers (access control, hooks, seed)
â”œâ”€â”€ shared/                     # Shared utilities
â”‚   â”œâ”€â”€ actions/                # Server actions (waitlist, auth)
â”‚   â”œâ”€â”€ components/             # Reusable components (Redirect)
â”‚   â””â”€â”€ lib/                    # Utilities (mongodb, payload, types, env)
â”œâ”€â”€ public/                     # Static assets
â”œâ”€â”€ payload.config.ts           # Payload CMS configuration
â”œâ”€â”€ next.config.ts              # Next.js configuration with withPayload
â””â”€â”€ tsconfig.json               # TypeScript configuration
```

**Architecture Patterns:**
- **Route Groups**: `(payload)` and `(client)` separate admin/client areas without affecting URLs
- **Parallel Routes**: Home page uses `@hero`, `@solutions` for advanced composition
- **Colocation**: Components live alongside their pages for better organization
- **Server-First**: Maximize server components, isolate interactivity to client components

### Core Data Models

Payload CMS collections define MongoDB schemas in `collections/*/config.ts`:

**Users:**
- Fields: `id`, `email`, `password` (hashed), `roles` (admin/user), `avatar`, `contacts` (relationship), `accounts` (relationship), `createdAt`, `updatedAt`
- Authentication: JWT-based with Payload auth (7200s expiration, 5 max login attempts)
- Relationships: One-to-Many with Accounts and Transactions

**Accounts:**
- Fields: `id`, `owner` (User ref), `provider` (stripe/paypal), `accountId`, `verified`, `balance`, `createdAt`
- Validation: User cannot have duplicate provider accounts
- Relationships: Many-to-One with Users

**Transactions:**
- Fields: `id`, `sender` (User ref), `receiver` (User ref), `senderAccount` (Account ref), `receiverAccount` (Account ref), `amount`, `currency`, `status` (pending/completed/failed), `createdAt`, `updatedAt`
- Validation: Cannot send to self, same-provider transfers restricted
- Relationships: Many-to-One with Users and Accounts

**Media:**
- Payload's built-in file upload collection
- Used for avatars and other user-uploaded assets

### Access Control & Security

**Centralized Helpers** (`collections/common/index.ts`):
```typescript
export function checkRole(allRoles: User["roles"] = [], user?: User | null) {
    if (user) {
        if (allRoles?.some(role => {
            return user?.roles?.some(individualRole => {
                return individualRole === role;
            })
        })) {
            return true;
        }
    }
    return false;
}

export const isAdmin: Access<User> = ({req: {user}}) => {
    return checkRole(["admin"], user);
}

export const isAdminOrSelf: Access<User> = ({req: {user}}) => {
    return checkRole(["admin"], user) || {owner: {equals: user?.id}};
}
```

**Collection-Level Access:**
- Admins: Full CRUD access to all collections
- Users: Can read/update their own data, read contacts, manage own accounts/transactions

**Field-Level Access:**
- Sensitive fields (e.g., `roles`) restricted to admin read/update
- Password hashing enforced by Payload auth
- JWT tokens stored in HTTP-only cookies

**Security Features:**
- HTTPS enforced on Vercel
- Environment variables for secrets (MongoDB URI, Payload secret)
- Rate limiting via Payload auth (lockout after 5 failed attempts)
- Input validation with Zod schemas in server actions

### API Routes

**Payload Auto-Generated (REST):**
- `/api/users` - User CRUD (GET/POST/PATCH/DELETE)
- `/api/accounts` - Account management
- `/api/transactions` - Transaction management
- `/api/media` - File uploads
- All routes include JWT authentication and access control

**Payload Auto-Generated (GraphQL):**
- `/api/graphql` - Full GraphQL API for all collections

**Custom Next.js Routes:**
- `/api/waitlist` (GET) - Export waitlist as CSV
- `/api/auth/*` - Custom auth flows if needed beyond Payload defaults

**Server Actions** (`shared/actions/`):
- `addToWaitlist` - Join waitlist form submission
- `auth` - Get current user session

All routes use:
- **Authentication**: Bearer JWT tokens from Payload
- **Validation**: Zod schemas for input validation
- **Error Handling**: Structured `ActionState<T>` responses
- **Types**: Auto-generated from Payload schema (`payload-types.ts`)

### Technology Stack

**Framework & Runtime:**
- Next.js 15 (App Router) - React framework with SSR/SSG
- React 19 - UI library with Server Components
- TypeScript - Type safety across entire stack
- Node.js - JavaScript runtime

**CMS & Database:**
- Payload CMS v3 - Headless CMS with admin UI
- MongoDB Atlas - Cloud-hosted NoSQL database
- Mongoose - MongoDB ODM (used by Payload)

**Styling:**
- Tailwind CSS v4 - Utility-first CSS framework
- PostCSS - CSS processing
- Custom theme extensions (Plus Jakarta Sans font, custom colors/animations)

**State & Forms:**
- React Server Actions - Form handling and mutations
- `useActionState` - Progressive enhancement for forms
- Zod - Schema validation

**Deployment & Hosting:**
- Vercel - Hosting platform with serverless functions
- Vercel Analytics & Speed Insights - Performance monitoring
- MongoDB Atlas - Database hosting

**Development Tools:**
- ESLint - Code linting (Next.js config)
- TypeScript strict mode - Enhanced type checking
- Payload CLI - Database migrations and admin generation

### Development Workflow

**Local Development:**
```bash
npm run dev          # Start Next.js dev server (includes Payload)
npm run build        # Production build
npm run lint         # Run ESLint
npm run payload      # Payload CLI commands (generate types, migrate)
```

**Environment Variables:**
```
MONGODB_URI              # Custom MongoDB connection for waitlist
MONGODB_GLIX_URI         # Payload MongoDB connection
PAYLOAD_SECRET           # JWT signing secret
NEXT_PUBLIC_SERVER_URL   # Public-facing URL
```

**Type Generation:**
Payload automatically generates TypeScript types in `payload-types.ts` based on collection schemas. Import with:
```typescript
import type { User, Account, Transaction } from '@/payload-types';
```

### Deployment Architecture

**Vercel Deployment:**
- **Region**: Auto (nearest to users)
- **Functions**: Serverless (Next.js API routes + Payload)
- **Static Assets**: Edge CDN for optimal delivery
- **Database**: MongoDB Atlas (separate hosting)

**Redirects** (configured in `next.config.ts`):
- `/login` â†’ `/auth/login`
- `/logout` â†’ `/auth/logout`
- `/signup` â†’ `/auth/signup`

**Build Process:**
1. TypeScript compilation
2. Payload type generation
3. Next.js build (static pages + serverless functions)
4. Vercel deployment with automatic HTTPS

### Key Design Decisions

**Why Next.js + Payload Integration?**
- **Performance**: In-process data access eliminates HTTP overhead
- **Developer Experience**: Single codebase, shared types, unified environment
- **Cost Efficiency**: One deployment vs. multiple services
- **Scalability**: Vercel's serverless architecture scales automatically

**Why Payload CMS?**
- **Type Safety**: Auto-generated TypeScript types from schemas
- **Flexibility**: Full control over data models and business logic
- **Admin UI**: Built-in admin panel with role-based access
- **Hooks System**: Lifecycle hooks for validation and side effects
- **Modern Stack**: Built on Express/Mongoose, works with Next.js

**Why MongoDB?**
- **Flexible Schema**: Easy iteration on data models
- **Payload Default**: Native support with best practices
- **Atlas**: Managed service with serverless compatibility
- **Performance**: Efficient for document-based payment data

**Why Vercel?**
- **Next.js Optimization**: Built by the same team
- **Serverless**: Auto-scaling without infrastructure management
- **Edge Network**: Global CDN for fast asset delivery
- **Developer Experience**: Git-based deployments, preview URLs

### Current Implementation Status

**Completed:**
- âœ… Core authentication (login, signup, JWT)
- âœ… User and Account collections with access control
- âœ… Transaction schema with validation hooks
- âœ… Waitlist functionality with MongoDB
- âœ… Marketing pages (home, about, join-waitlist)
- âœ… Responsive UI with Tailwind CSS v4
- âœ… Vercel deployment pipeline

**In Progress:**
- ðŸŸ¡ Payment provider integrations (Stripe, PayPal)
- ðŸŸ¡ Transaction initiation flow
- ðŸŸ¡ User dashboard for transaction history
- ðŸŸ¡ Admin panel customization

**Planned:**
- âšª Real-time transaction status updates
- âšª Email notifications (via Payload email plugin)
- âšª KYC document uploads (using Media collection)
- âšª Analytics dashboard for admins
- âšª Multi-currency support